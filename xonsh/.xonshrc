#!/bin/env xonsh
$PATH = ["$HOME/miniconda3/bin"] + $PATH
$PATH = ["$HOME/.cargo/bin"] + $PATH
$PATH = ["/usr/lib/ccache"] + $PATH

# xontrib load xonda

$PROMPT_FIELDS['env_name'] = lambda: "("+$CONDA_DEFAULT_ENV+")" if 'CONDA_DEFAULT_ENV' in __xonsh__.env else None
def prompt_end():
    s = '\n'
    if __xonsh__.history and __xonsh__.history[-1].rtn !=0:
        s += '{BOLD_RED}'
    s += '$ '
    return s
$PROMPT_FIELDS['prompt_end'] = prompt_end
$XONSH_GITSTATUS_STASHED = '⚑ '
$XONSH_GITSTATUS_STAGED = '{RED}● '
$PROMPT = '{env_name:{} }{BOLD_GREEN}{user}@{hostname}{BOLD_BLUE} {short_cwd} {gitstatus}{NO_COLOR} {BOLD_BLUE}{prompt_end}{NO_COLOR}'
$PROMPT = '{vte_new_tab_cwd}' + $PROMPT

with open('/etc/hostname', 'r') as f:
    $HOSTNAME = f.readline().strip()

import warnings
warnings.filterwarnings('ignore', category=DeprecationWarning)

# https://unix.stackexchange.com/questions/12107/how-to-unfreeze-after-accidentally-pressing-ctrl-s-in-a-terminal
stty -ixon


# Coloured man page support
# using 'less' env vars (format is '\E[<brightness>;<colour>m')
$LESS_TERMCAP_mb = "\033[01;31m"     # begin blinking
$LESS_TERMCAP_md = "\033[01;31m"     # begin bold
$LESS_TERMCAP_me = "\033[0m"         # end mode
$LESS_TERMCAP_so = "\033[01;44;36m"  # begin standout-mode (bottom of screen)
$LESS_TERMCAP_se = "\033[0m"         # end standout-mode
$LESS_TERMCAP_us = "\033[00;36m"     # begin underline
$LESS_TERMCAP_ue = "\033[0m"         # end underline


def _pwdcopy():
    work_dir = $(pwd).strip()
    echo -n @(work_dir) | pbcopy

aliases['pbcopy'] = 'xclip -i -selection clipboard'
aliases['pbpaste'] = 'xclip -i -selection clipboard -o'
aliases['pwdcopy'] = _pwdcopy
aliases['nv'] = 'nvim'
aliases['vim'] = 'nvim'


# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
import sys as _sys
from types import ModuleType as _ModuleType
_mod = _ModuleType("xontrib.conda",
                   "Autogenerated from $(/home/mark/miniconda3/bin/conda shell.xonsh hook)")
__xonsh__.execer.exec($("/home/mark/miniconda3/bin/conda" "shell.xonsh" "hook"),
                      glbs=_mod.__dict__,
                      filename="$(/home/mark/miniconda3/bin/conda shell.xonsh hook)")
_sys.modules["xontrib.conda"] = _mod
del _sys, _mod, _ModuleType
# <<< conda initialize <<<

conda activate mcam
